{{- /*
  Enhanced Article schema for better SEO
  This extends the theme's BlogPosting schema with additional Article properties
  Only rendered for pages (articles), not sections or home
*/ -}}
{{- if and .IsPage (site.Params.seo.enableSchema | default true) -}}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": {{ .Title | plainify | jsonify }},
  "description": {{ with .Description | plainify }}{{ . | jsonify }}{{ else }}{{ .Summary | plainify | truncate 200 | jsonify }}{{ end }},
  {{- /* Image handling */ -}}
  {{- if .Params.cover.image -}}
  "image": [
    {{- if (ne .Params.cover.relative true) -}}
    {{ .Params.cover.image | absURL | jsonify }}
    {{- else -}}
    {{ (path.Join .RelPermalink .Params.cover.image ) | absURL | jsonify }}
    {{- end }}
    {{- /* Add first content image if available */ -}}
    {{- $images := partial "templates/_funcs/get-page-images" . -}}
    {{- with index $images 0 -}}
    , {{ .Permalink | jsonify }}
    {{- end -}}
  ],
  {{- else -}}
    {{- $images := partial "templates/_funcs/get-page-images" . -}}
    {{- with index $images 0 -}}
  "image": {{ .Permalink | jsonify }},
    {{- end -}}
  {{- end -}}
  {{- /* Dates */ -}}
  {{- if .PublishDate -}}
  "datePublished": {{ .PublishDate.Format "2006-01-02T15:04:05-07:00" | jsonify }},
  {{- end -}}
  {{- if .Lastmod -}}
  "dateModified": {{ .Lastmod.Format "2006-01-02T15:04:05-07:00" | jsonify }},
  {{- end -}}
  {{- /* Author information */ -}}
  {{- with (.Params.author | default site.Params.author) -}}
  "author": {
    "@type": "Person",
    "name": {{ . | jsonify }}{{ if site.Params.social }},
    "url": {{ with site.Params.social.website }}{{ . | jsonify }}{{ end }}{{ end }}
  },
  {{- end -}}
  {{- /* Publisher information */ -}}
  "publisher": {
    "@type": "{{ site.Params.schema.publisherType | default "Organization" | title }}",
    "name": {{ site.Title | jsonify }},
    "logo": {
      "@type": "ImageObject",
      "url": {{ (site.Params.assets.favicon | default "favicon.ico") | absURL | jsonify }},
      "width": 32,
      "height": 32
    }
  },
  {{- /* Main entity */ -}}
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": {{ .Permalink | jsonify }}
  },
  {{- /* Article body */ -}}
  {{- if .Content -}}
  "articleBody": {{ .Content | plainify | truncate 5000 | jsonify }},
  {{- end -}}
  {{- /* Word count */ -}}
  "wordCount": {{ .WordCount }},
  {{- /* Language */ -}}
  "inLanguage": {{ .Language.Lang | default "zh-tw" | jsonify }},
  {{- /* Keywords/Tags */ -}}
  {{- $keywords := slice -}}
  {{- if .Params.keywords -}}
    {{- $keywords = .Params.keywords -}}
  {{- else if .Params.tags -}}
    {{- $keywords = .Params.tags -}}
  {{- end -}}
  {{- if $keywords -}}
  "keywords": [
    {{- range $i, $e := $keywords -}}
    {{- if $i }}, {{ end -}}
    {{ $e | jsonify }}
    {{- end -}}
  ],
  {{- end -}}
  {{- /* Article section */ -}}
  {{- if .Section -}}
  "articleSection": {{ .Section | jsonify }},
  {{- end -}}
  {{- /* Category mapping */ -}}
  {{- if .Params.categories -}}
  "about": [
    {{- range $i, $cat := .Params.categories -}}
    {{- if $i }}, {{ end -}}
    {
      "@type": "Thing",
      "name": {{ $cat | jsonify }}
    }
    {{- end -}}
  ],
  {{- end -}}
  {{- /* URL */ -}}
  "url": {{ .Permalink | jsonify }}
}
</script>
{{- end -}}
